<div *ngIf="problem" class="container">
  <div class="row">
    <h2 class="problem-name">{{problem.name}}</h2>
  </div>
  <ul class="row problem-tabs nav nav-tabs">
    <li [ngClass]="{'active': isCurrentTab('Problem')}">
      <a (click)="goToProblemTab()">Problem</a>
    </li>
    <li [ngClass]="{'active': isCurrentTab('MySubmissions')}">
      <a (click)="goToMySubmissionsTab()">My Submissions</a>
    </li>
    <li [ngClass]="{'active': isCurrentTab('Leaderboard')}">
      <a (click)="goToLeaderboardTab()">Leaderboard</a>
    </li>
  </ul>
  <!-- Problem Tab -->
  <div class="problem-tab" *ngIf="isCurrentTab('Problem')">
    <div class="row">
      <p class="col-xs-12 col-md-9 problem-description" [innerHTML]="problem.description"></p>
      <div class="col-xs-12 col-md-3 pull-right problem-details">
        <div class="clearfix problem-detail">
          <span class="pull-left problem-detail-label">Difficulty:</span> <span class="pull-right problem-detail-value">{{problem.difficulty}}</span>
        </div>
        <div class="clearfix">
          <span class="pull-left problem-detail-label">Execution Time Limit:</span> <span class="pull-right">{{problem.timeout}} seconds</span>
        </div>
      </div>
    </div>
    <div class="row">
      <app-language-dropdown (langChange)="onLangChange($event)" class="pull-right"></app-language-dropdown>
    </div>
    <div class="row">
      <textarea
          class="form-control"
          placeholder="Type your solution here..."
          [(ngModel)]="sourceCode">
      </textarea>
    </div>
    <div class="row problem-submission-details clearfix">
      <p class="problem-char-limit pull-right">{{numChars()}}/{{CharacterLimit}}</p>
    </div>
    <div class="row clearfix">
      <button (click)="submit()" class="problem-submit btn btn-primary pull-right">Submit</button>
    </div>
  </div>
  <!-- My Submissions Tab -->
  <div class="problem-tab" *ngIf="isCurrentTab('MySubmissions')">
    <!-- TODO: once you can log in this needs to be addressed -->
    <!--<div *ngIf="problem.submissionsByUser[my-uid]" class="problem-my-submissions">
      this is a test
    </div>
    <div *ngIf="!problem.submissionsByUser[my-uid]" class="problem-my-submissions-absent">-->
    <div class="problem-my-submissions-absent">
      <p>You currently have no submissions!</p>
      <a class="btn btn-primary" (click)="goToProblemTab()">Solve Now</a>
    </div>
    <!--</div>-->
  </div>
  <!-- Leaderboard Tab -->
  <div class="problem-tab" *ngIf="isCurrentTab('Leaderboard')">
    <div *ngIf="problem.successfulSubmissions" class="problem-my-submissions list-group">
      <div *ngFor="let submission of problem.successfulSubmissions; let i = index" class="list-group-item row">
        <div class="col-xs-1 leaderboard-rank">{{i+1}}</div>
        <!-- TODO: resolve uid -->
        <div class="col-xs-3 leaderboard-user">{{submission.submitterUid}}</div>
        <div class="col-xs-2 leaderboard-lang">{{submission.lang}}</div>
        <div class="col-xs-3 leaderboard-time">{{submission.execTime}}</div>
        <div class="col-xs-3 leaderboard-date">{{submission.submittedOn | date:'medium'}}</div>
      </div>
    </div>
    <div *ngIf="!problem.successfulSubmissions" class="problem-leaderboard-absent">
      <p>There are no submissions yet!</p>
      <a class="btn btn-primary" (click)="goToProblemTab()">Solve Now</a>
    </div>
  </div>
</div>

<!-- The modal that will pop up on submit. -->
<div bsModal #submissionModal="bs-modal" class="modal fade"
    [config]="{backdrop: 'static'}" tabindex="-1"
    role="dialog" aria-labelledby="submission-modal" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-body submission-modal-body">
        <div class="row">
          <h3>Submitting your code...</h3>
        </div>
        <div class="loading-spinner center-block">
          <div>
            <div></div>
          </div>
          <div>
            <div></div>
          </div>
          <div>
            <div></div>
          </div>
          <div>
            <div></div>
          </div>
          <div>
            <div></div>
          </div>
          <div>
            <div></div>
          </div>
          <div>
            <div></div>
          </div>
          <div>
            <div></div>
          </div>
        </div>
        <input (click)="cancelSubmit()" class="btn btn-lg btn-default" type="button" value="Cancel">
      </div>
    </div>
  </div>
</div>
